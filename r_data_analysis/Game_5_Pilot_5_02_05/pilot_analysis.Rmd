---
title: "Concept Learning: Pilot Analysis"
author: Sahil Chopra
date: "Wednesday, February 07, 2018"
output: html_notebook
---

## Introduction

Here, we attempt to try to replicate some of the results from Piantadosi 2016 (The Logical Primitives of Thought: Empirical Foundation for Compositional Cognitive Models). As a part of this replication, we use different stimuli - but mantain three axes of variability with three potential values for a total of 27 possible objects. To examine some examples of stimuli and play the concept learning game for yourself, please checkout [this link](http://web.stanford.edu/~schopra8/gen-games/experiments/game-5/game-5.html).

## Experimental Setup

### Selected Concepts
For this initial pilot, we attempted to replicate two concepts from Piantadosi 2016. We chose one concept that seemed relatively easy and one concept that seemed relatively difficult for participants in the original paper. We purposely avoided using any rules that required quantifiers, selecting two boolean concepts. This focus on boolean concepts, allowed us to leverage a more traditional concept learning paradigm -- showing one object at a time, rather than a set of objects as in the Piantadosi paper. 

Instead of using shapes, size, and color for the three axes of variability, we user different critters from the [stimuli project](https://github.com/erindb/stimuli). Specifically, we use three different types of critters: fish, bugs, and birds. Each critter could be one of three different sizes and one of three different colors.  

The two selected concepts for ths initial pilot were:

1. Easy: ORANGE

2. Hard: FISH XOR BLUE

### Stimuli Generation
For this experiment, we create the stimuli from randomly sampling the three properties described above with replacement. We then stored this set of randomly sampled objects.

### Running the Experiment
We ran the experiment on MTurk such that each participant had 50 rounds, where they had to a label the given critter as "wudsy" or "not wudsy". At first participants had to guess, but after each round we added the previous stimulus to a table, boxing the "wudsy" ones. If the participant incorrectly labeled a critter they had to wait 5 seconds before the next round.

We ran the easy concept across 4 participants and the hard concept across 5 participants.
 
### Results
If I were to repeat this pilot experiment, I would fix a bug in my game -- where I did not correctly log how participants would have described the concept to another person. Additionally, I would have had an extra test to gauge performance. I could theoretically still do this analysis by using the first 40 exampels are "training" and last 10 as "test".

#### Acccuracy Across Learning
```{r}
library(readr)
library(dplyr)
library(ggplot2)
setwd("../../mturk/game-5/pilot")
easy_concept_data <- read_csv(file="./easy_concept/game-5-trials.csv", col_names=TRUE, col_types = "iilild")
hard_concept_data <- read_csv(file="./hard_concept/game-5-trials.csv", col_names=TRUE, col_types = "iilild")

# Get the accuracies for the individual participants
num_easy = 4
num_hard = 5
num_trials = 50

get_accuracy <- function(num_participants, num_trials, data) {
  acc <- vector("list", num_participants)
  i = 0
  while (i < num_participants) {
    single_worker_data <- data %>% filter(workerid == i)
    num_correct = length(which(single_worker_data$labels == single_worker_data$true_labels))
    acc[i+1] = num_correct / num_trials
    i = i + 1
  }
  acc
}

# Accuracy throughout learning process
easy_acc <- data.frame(partcipant_num=1:num_easy, accuracy=unlist(get_accuracy(num_easy, num_trials, easy_concept_data)), concept=rep(1, num_easy))
hard_acc <- data.frame(partcipant_num=1:num_hard, accuracy=unlist(get_accuracy(num_hard, num_trials, hard_concept_data)), concept=rep(2, num_hard))
acc <- rbind(easy_acc, hard_acc)
acc$concept <- as.factor(acc$concept)

# Plot
ggplot(acc, aes(x=partcipant_num, fill=concept, y=accuracy)) +
  geom_dotplot(binaxis = "y", stackdir = "center")

```

#### Accuracy First 25% Vs. Last 25%
```{r}
# Accuracy throughout learning process (Easy Concept)
trials_25p = ceiling(num_trials * 0.25)
easy_acc_first_25p <- data.frame(partcipant_num=1:num_easy, accuracy=unlist(get_accuracy(num_easy, trials_25p, easy_concept_data %>% filter(trial_num <= num_trials * 0.25))), concept=rep(1, num_easy), time=rep(1, num_easy))
easy_acc_final_25p <- data.frame(partcipant_num=1:num_easy, accuracy=unlist(get_accuracy(num_easy, trials_25p, easy_concept_data %>% filter(num_trials * 0.75 <= trial_num))), concept=rep(1, num_easy), time=rep(2, num_easy))
easy_acc_delta <- rbind(easy_acc_first_25p, easy_acc_final_25p)
easy_acc_delta$time <- as.factor(easy_acc_delta$time)
easy_acc_delta$partcipant_num <- as.factor(easy_acc_delta$partcipant_num)

# Plot
ggplot(data=easy_acc_delta, aes(x=partcipant_num, fill=time, y=accuracy)) +
  geom_dotplot(binaxis = "y", stackdir = "center") +
  labs(title = "Easy Concept: Participant Accuracy First 25% vs. Last 25%")

# Accuracy throughout learning process (Hard Concept)
hard_acc_first_25p <- data.frame(partcipant_num=1:num_hard, accuracy=unlist(get_accuracy(num_hard, trials_25p, hard_concept_data %>% filter(trial_num <= num_trials * 0.25))), concept=rep(1, num_hard), time=rep(1, num_hard))
hard_acc_final_25p <- data.frame(partcipant_num=1:num_hard, accuracy=unlist(get_accuracy(num_hard, trials_25p, hard_concept_data %>% filter(num_trials * 0.75 <= trial_num))), concept=rep(1, num_hard), time=rep(2, num_hard))
hard_acc_delta <- rbind(hard_acc_first_25p, hard_acc_final_25p)
hard_acc_delta$time <- as.factor(hard_acc_delta$time)
hard_acc_delta$partcipant_num <- as.factor(hard_acc_delta$partcipant_num)

# Plot
ggplot(data=hard_acc_delta, aes(x=partcipant_num, fill=time, y=accuracy)) +
  geom_dotplot(binaxis = "y", stackdir = "center") +
  labs(title = "Hard Concept: Participant Accuracy First 25% vs. Last 25%")

```

#### Stimuli Anaylsis
Now we examine the breakdown of the stimuli to see what the accuracy base rates would be if a participant selected one label for all critters. First we start with the easy concept.

```{r}
# easy_25p_num_pos = sum((easy_concept_data %>% filter(trial_num <= num_trials * 0.25))$true_labels, na.rm=TRUE) / num_easy
# sprintf("Number of Positive Labels in first 25%% of Easy Game: %i", easy_25p_num_pos)
# sprintf("Number of Negative Labels in first 25%% of Easy Game: %i", floor(num_trials * 0.25) - easy_25p_num_pos)
# sprintf("%% of Positive Labels in first 25%% of Easy Game: %f", easy_25p_num_pos / floor(num_trials * 0.25))
# sprintf("%% of Negative Labels in first 25%% of Easy Game: %f", 1 - easy_25p_num_pos / floor(num_trials * 0.25))
# 
# print('-----------------')
# 
# easy_75p_num_pos = sum((easy_concept_data %>% filter(num_trials * 0.75 <= trial_num))$true_labels, na.rm=TRUE) / num_easy
# sprintf("Number of Positive Labels in last 25%% of Easy Game: %i", easy_75p_num_pos)
# sprintf("Number of Negative Labels in last 25%% of Easy Game: %i", floor(num_trials * 0.25) - easy_75p_num_pos)
# sprintf("%% of Positive Labels in first last 25%% of Easy Game: %f", easy_75p_num_pos / floor(num_trials * 0.25))
# sprintf("%% of Negative Labels in first last 25%% of Easy Game: %f", 1 - easy_75p_num_pos / floor(num_trials * 0.25))
```

Next we look at the hard concept.
```{r}
# hard_25p_num_pos = sum((hard_concept_data %>% filter(trial_num <= num_trials * 0.25))$true_labels, na.rm=TRUE) / num_hard
# sprintf("Number of Positive Labels in first 25%% of Hard Game: %i", hard_25p_num_pos)
# sprintf("Number of Negative Labels in first 25%% of Hard Game: %i", floor(num_trials * 0.25) - hard_25p_num_pos)
# sprintf("%% of Positive Labels in first 25%% of Hard Game: %f", hard_25p_num_pos / floor(num_trials * 0.25))
# sprintf("%% of Negative Labels in first 25%% of Hard Game: %f", 1 - hard_25p_num_pos / floor(num_trials * 0.25))
# 
# print('-----------------')
# 
# hard_75p_num_pos = sum((hard_concept_data %>% filter(num_trials * 0.75 <= trial_num))$true_labels, na.rm=TRUE) / num_hard
# sprintf("Number of Positive Labels in last 25%% of Hard Game: %i", hard_75p_num_pos)
# sprintf("Number of Negative Labels in last 25%% of Hard Game: %i", floor(num_trials * 0.25) - hard_75p_num_pos)
# sprintf("%% of Positive Labels in first last 25%% of Hard Game: %f", hard_75p_num_pos / floor(num_trials * 0.25))
# sprintf("%% of Negative Labels in first last 25%% of Hard Game: %f", 1 - hard_75p_num_pos / floor(num_trials * 0.25))
```

### Response Analysis
```{r}
easy_acc <- easy_concept_data %>%
  mutate(answer = ifelse(true_labels,
                          ifelse(labels, "correct", "incorrect"),
                          ifelse(labels, "incorrect", "correct")
                         )) %>%
  group_by(workerid) %>% # for each workerid, pick out their max
    mutate(max_n_trials = max(trial_num)) %>%
  ungroup() %>%
  mutate(trial_quartile = ceiling(4*(trial_num/max_n_trials) )) %>%
  group_by(workerid, trial_quartile, answer) %>%
  count()

hard_acc <- hard_concept_data %>%
  mutate(answer = ifelse(true_labels,
                          ifelse(labels, "correct", "incorrect"),
                          ifelse(labels, "incorrect", "correct")
                         )) %>%
  group_by(workerid) %>% # for each workerid, pick out their max
    mutate(max_n_trials = max(trial_num)) %>%
  ungroup() %>%
  mutate(trial_quartile = ceiling(4*(trial_num/max_n_trials) )) %>%
  group_by(workerid, trial_quartile, answer) %>%
  count()
```
```{r fig.width= 6, fig.height=3}
ggplot(easy_acc, aes(x = trial_quartile, fill = answer, y = n))+
  geom_col() +
  facet_wrap(~workerid, nrow = 1) +
  labs(title = "Easy Concept")
```
```{r fig.width= 6, fig.height=3}
ggplot(hard_acc, aes(x = trial_quartile, fill = answer, y = n))+
  geom_col() +
  facet_wrap(~workerid, nrow = 1) +
  labs(title = "Hard Concept")
```

```{r}
easy_concept_data_quartileSummary <- easy_concept_data %>%
  mutate(responseType = ifelse(true_labels, 
                               ifelse(labels, "hit", "miss"), 
                               ifelse(labels, "false alarm", "correct rejection")
                               )) %>%
  group_by(workerid) %>% # for each workerid, pick out their max
    mutate(max_n_trials = max(trial_num)) %>% 
  ungroup() %>%
  mutate(trial_quartile = ceiling(4*(trial_num/max_n_trials) )) %>%
  group_by(workerid, trial_quartile, responseType) %>%
  count()
```

```{r fig.width= 6, fig.height=3}
ggplot(easy_concept_data_quartileSummary, aes(x = trial_quartile, fill = responseType, y = n))+
  geom_col()+#position = position_dodge())+
  facet_wrap(~workerid, nrow = 1) +
  labs(title = "Easy Concept")
```
```{r}
hard_concept_data_quartileSummary <- hard_concept_data %>%
  mutate(responseType = ifelse(true_labels, 
                               ifelse(labels, "hit", "miss"), 
                               ifelse(labels, "false alarm", "correct rejection")
                               )) %>%
  group_by(workerid) %>% # for each workerid, pick out their max
    mutate(max_n_trials = max(trial_num)) %>% 
  ungroup() %>%
  mutate(trial_quartile = ceiling(4*(trial_num/max_n_trials) )) %>%
  group_by(workerid, trial_quartile, responseType) %>%
  count()
```

```{r fig.width= 6, fig.height=3}
ggplot(hard_concept_data_quartileSummary, aes(x = trial_quartile, fill = responseType, y = n))+
  geom_col()+#position = position_dodge())+
  facet_wrap(~workerid, nrow = 1) + 
  labs(title="Hard Concept")
```

#### TODO: Rational Rules Analysis

